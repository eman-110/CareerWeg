<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Applied Jobs</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <iframe id="header-frame" src="../../header-main.html"></iframe>

  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h3>CANDIDATE DASHBOARD</h3>
      <nav class="sidebar-nav">
        <a href="../Dashboard/index.html" class="nav-item">
          <img src="../../assets/img/profile.png" alt="Profile Icon" />
          <span>Profile</span>
        </a>
        <a href="../Applied Job/index.html" class="nav-item1">
          <img src="../../assets/img/jobs.png" alt="Job Listing Icon" />
          <span>Applied Jobs</span>
        </a>
        <a href="../My Courses In Progress/index.html" class="nav-item">
          <img src="../../assets/img/My Courses.png" alt="Job Listing Icon" />
          <span>My Courses</span>
        </a>
      </nav>
      <a href="../../BeforeLogin/HomePageBeforeLogin/homePageBeforeLogin.html" class="logout">
        <img src="../../assets/img/logout.png" alt="Logout Icon" />
        <span>Log-out</span>
      </a>
    </aside>

    <!-- Right Side Content -->
    <main class="main-content">
      <div class="content-card">
        <h1>Applied Jobs</h1>
        <div class="table-header">
          <span>Jobs</span>
          <span>Date Applied</span>
          <span>Action</span>
        </div>

        <form method="post" class="job-list-form">
          <!-- Jobs will be inserted here dynamically -->
        </form>
      </div>
    </main>
  </div>

  <iframe id="footer-frame" src="../../footer-main.html"></iframe>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const res = await fetch("/api/jobs/applied-jobs");
      const container = document.querySelector(".job-list-form");

      if (!res.ok) {
        container.innerHTML = "<p style='padding:1rem;'>Failed to load applied jobs.</p>";
        return;
      }

      const applications = await res.json();
      container.innerHTML = ""; // Clear placeholder

      applications.forEach(app => {
        const job = app.jobs;
        const appliedDate = new Date(app.appliedAt).toLocaleDateString();

        const jobBlock = document.createElement("div");
        jobBlock.className = "job-card";

        jobBlock.innerHTML = `
          <input type="hidden" name="job_title" value="${job.jobTitle}">
          <input type="hidden" name="job_details" value="${job.duration || "-"} / Rs ${job.minBudget || 0}-${job.maxBudget || 0}">
          <input type="hidden" name="job_date" value="${appliedDate}">

          <div class="job-info">
            <span class="job-title">${job.jobTitle}</span>
            <span class="job-details">${job.duration || "-"} / Rs ${job.minBudget || 0}-${job.maxBudget || 0}</span>
          </div>

          <div class="job-date">${appliedDate}</div>

          <button type="button" class="view-btn" onclick="window.location.href='/AfterLogin/View Detail/index.html?jobId=${job.id}'">
            View Detail
          </button>
        `;

        container.appendChild(jobBlock);
      });
    });
  </script>
</body>
</html>
